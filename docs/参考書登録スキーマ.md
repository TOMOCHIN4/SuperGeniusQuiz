# 参考書登録API スキーマガイド

## エンドポイント

```
POST https://script.google.com/macros/s/AKfycbwzRzBLo0D32sn5lI9vgvDsc7vmJW4VZ9_m1kM_he5iGPWF-CJ6steCcCGOFoTnxK3D/exec
```

---

## リクエスト構造

```json
{
  "action": "create_book",
  "subject": "教科コード",
  "title": "参考書名",
  "questions": [
    {
      "question_text": "問題文",
      "choice_1": "選択肢1",
      "choice_2": "選択肢2",
      "choice_3": "選択肢3",
      "choice_4": "選択肢4",
      "correct_index": 1,
      "hint": "ヒント"
    }
  ]
}
```

---

## フィールド詳細

### 必須フィールド

| 日本語名 | フィールド名 | 型 | 説明 | 例 |
|---------|------------|------|------|-----|
| アクション | `action` | string | 固定値 `"create_book"` | `"create_book"` |
| 教科コード | `subject` | string | 4種類のいずれか | `"jp"` |
| 参考書名 | `title` | string | 参考書のタイトル | `"漢字マスター3000"` |

### 任意フィールド

| 日本語名 | フィールド名 | 型 | 説明 | デフォルト |
|---------|------------|------|------|-----------|
| 問題リスト | `questions` | array | 問題オブジェクトの配列 | `[]`（空配列） |

---

## 教科コード一覧

| 教科コード | 教科名 |
|-----------|-------|
| `jp` | 国語 |
| `math` | 算数 |
| `sci` | 理科 |
| `soc` | 社会 |

---

## 問題オブジェクト構造

各問題は以下の構造を持ちます。

### 問題フィールド

| 日本語名 | フィールド名 | 型 | 必須 | 説明 | 例 |
|---------|------------|------|------|------|-----|
| 問題文 | `question_text` | string | ○ | 問題の本文 | `"日本の首都はどこですか？"` |
| 選択肢1 | `choice_1` | string | ○ | 1番目の選択肢 | `"東京"` |
| 選択肢2 | `choice_2` | string | ○ | 2番目の選択肢 | `"大阪"` |
| 選択肢3 | `choice_3` | string | ○ | 3番目の選択肢 | `"京都"` |
| 選択肢4 | `choice_4` | string | ○ | 4番目の選択肢 | `"名古屋"` |
| 正解番号 | `correct_index` | number | △ | 正解の選択肢番号（1〜4） | `1` |
| ヒント | `hint` | string | - | 解説やヒント | `"日本の政治の中心地です"` |

### 選択肢の代替記法

選択肢は配列形式でも指定可能です：

```json
{
  "question_text": "問題文",
  "choices": ["選択肢1", "選択肢2", "選択肢3", "選択肢4"],
  "correct_index": 1
}
```

| 日本語名 | フィールド名 | 型 | 説明 |
|---------|------------|------|------|
| 選択肢配列 | `choices` | string[] | 4つの選択肢を配列で指定 |

---

## リクエスト例

### 例1: 空の参考書を作成

```json
{
  "action": "create_book",
  "subject": "jp",
  "title": "漢字ドリル基礎編"
}
```

### 例2: 問題付きで参考書を作成

```json
{
  "action": "create_book",
  "subject": "soc",
  "title": "都道府県マスター",
  "questions": [
    {
      "question_text": "日本で一番面積が大きい都道府県はどこですか？",
      "choice_1": "北海道",
      "choice_2": "岩手県",
      "choice_3": "長野県",
      "choice_4": "新潟県",
      "correct_index": 1,
      "hint": "日本の最北端にある島です"
    },
    {
      "question_text": "富士山がまたがる2つの県はどこですか？",
      "choice_1": "静岡県と山梨県",
      "choice_2": "静岡県と長野県",
      "choice_3": "山梨県と神奈川県",
      "choice_4": "長野県と山梨県",
      "correct_index": 1,
      "hint": "日本一高い山です"
    }
  ]
}
```

### 例3: 配列形式で選択肢を指定

```json
{
  "action": "create_book",
  "subject": "math",
  "title": "計算ドリル",
  "questions": [
    {
      "question_text": "12 + 8 = ?",
      "choices": ["18", "20", "22", "24"],
      "correct_index": 2
    }
  ]
}
```

---

## レスポンス構造

### 成功時

```json
{
  "success": true,
  "book_id": "jp_漢字ドリル基礎編",
  "subject": "jp",
  "title": "漢字ドリル基礎編",
  "question_count": 0,
  "message": "参考書「漢字ドリル基礎編」を作成しました"
}
```

| 日本語名 | フィールド名 | 型 | 説明 |
|---------|------------|------|------|
| 成功フラグ | `success` | boolean | 処理成功なら `true` |
| 参考書ID | `book_id` | string | シート名（`{教科}_{タイトル}`形式） |
| 教科コード | `subject` | string | 指定した教科コード |
| 参考書名 | `title` | string | 指定した参考書名 |
| 問題数 | `question_count` | number | 登録した問題の数 |
| メッセージ | `message` | string | 処理結果のメッセージ |

### 失敗時

```json
{
  "success": false,
  "error": "エラーメッセージ"
}
```

### エラー例

| エラーメッセージ | 原因 |
|----------------|------|
| `教科は jp, math, sci, soc のいずれかを指定してください` | 無効な教科コード |
| `参考書名を指定してください` | title が空または未指定 |
| `シート「jp_漢字ドリル」は既に存在します` | 同名の参考書が既に存在 |

---

## 自動設定されるフィールド

以下のフィールドはAPIが自動的に設定します：

| 日本語名 | フィールド名 | 自動設定値 | 説明 |
|---------|------------|-----------|------|
| 問題ID | `question_id` | 連番（1, 2, 3...） | 問題の順番に自動採番 |
| 出題回数 | `usage_count` | `0` | 初期値は0、出題されるたびに+1 |

---

## 作成されるシートの構造

APIが作成するシートのカラム構成：

| カラム | 日本語名 | 説明 |
|-------|---------|------|
| A | 問題ID | 自動採番される連番 |
| B | 問題文 | クイズの問題文 |
| C | 選択肢1 | 1番目の選択肢 |
| D | 選択肢2 | 2番目の選択肢 |
| E | 選択肢3 | 3番目の選択肢 |
| F | 選択肢4 | 4番目の選択肢 |
| G | 正解番号 | 正解の選択肢番号（1〜4） |
| H | ヒント | 解説やヒント |
| I | 出題回数 | 出題された回数（自動更新） |

---

## Pythonでの送信例

```python
import requests
import json

url = "https://script.google.com/macros/s/AKfycbwzRzBLo0D32sn5lI9vgvDsc7vmJW4VZ9_m1kM_he5iGPWF-CJ6steCcCGOFoTnxK3D/exec"

data = {
    "action": "create_book",
    "subject": "jp",
    "title": "漢字テスト",
    "questions": [
        {
            "question_text": "「山」の読み方は？",
            "choice_1": "やま",
            "choice_2": "かわ",
            "choice_3": "うみ",
            "choice_4": "もり",
            "correct_index": 1,
            "hint": "高くそびえる自然の地形です"
        }
    ]
}

response = requests.post(url, data=json.dumps(data))
print(response.json())
```

---

**最終更新**: 2026-01-02
